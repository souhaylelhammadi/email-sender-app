<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sender Pro - Service d'envoi d'emails</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: none;
            border-radius: 15px;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.98);
        }
        .card-header {
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
            padding: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .send-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            padding: 15px 30px;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .premium-section {
            border: 3px solid #ffd700;
            background: linear-gradient(135deg, #fff9e6, #fff3cd);
        }
        .premium-header {
            background: linear-gradient(45deg, #ffd700, #ffed4e) !important;
            color: #856404 !important;
        }
        .usage-counter {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        .disabled-btn {
            background: #6c757d !important;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .payment-form {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid #dee2e6;
        }
        .plan-card {
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            height: 100%;
        }
        .plan-card:hover {
            transform: translateY(-5px);
            border-color: #007bff;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .recommended {
            border: 3px solid #ffd700;
            position: relative;
        }
        .recommended-badge {
            position: absolute;
            top: -12px;
            right: 20px;
            background: #ffd700;
            color: #856404;
            padding: 6px 18px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.75em;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .card {
                margin-bottom: 15px;
            }
            .card-header {
                padding: 15px;
            }
            .send-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            .usage-counter {
                padding: 15px;
                margin: 10px 0;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding: 10px;
            }
            .payment-form {
                padding: 15px;
            }
            .plan-card {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-tête -->
        <div class="text-center text-white mb-5">
            <h1 class="display-5 fw-bold mb-3">Email Sender Pro</h1>
            <p class="lead mb-4">Service professionnel d'envoi d'emails en masse</p>
        </div>

        <!-- Compteur d'utilisation -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Votre Utilisation</h5>
            </div>
            <div class="card-body">
                <div class="usage-counter">
                    <h3 class="text-primary" id="usageCount">0/2</h3>
                    <p class="mb-1 text-muted">Emails envoyés (Essai gratuit)</p>
                    <small class="text-muted">Après 2 emails, passez à la version premium</small>
                </div>
            </div>
        </div>

        <!-- Formulaire d'envoi -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">Envoyer des Emails</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Essai gratuit :</strong> 2 emails offerts pour tester notre service
                </div>

                <form id="emailForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Votre Email Gmail</label>
                            <input type="email" class="form-control" id="senderEmail" placeholder="votre.email@gmail.com" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Mot de passe d'application</label>
                            <input type="password" class="form-control" id="senderPassword" placeholder="Votre mot de passe d'application" required>
                            <div class="form-text">
                                <a href="https://myaccount.google.com/apppasswords" target="_blank" class="text-decoration-none">
                                    Comment créer un mot de passe d'application
                                </a>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-semibold">Sujet</label>
                            <input type="text" class="form-control" id="emailSubject" placeholder="Sujet de votre message" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-semibold">Message</label>
                            <textarea class="form-control" id="emailMessage" rows="4" placeholder="Tapez votre message ici..." required></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-semibold">Destinataires</label>
                            <textarea class="form-control" id="emailRecipients" rows="3" placeholder="email1@example.com&#10;email2@example.com" required></textarea>
                            <div class="form-text">Un email par ligne. Maximum 2 destinataires pour l'essai gratuit.</div>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn send-btn text-white w-100 py-3" id="sendButton">
                                <span id="buttonText">Envoyer les emails</span>
                                <div id="loadingSpinner" class="spinner-border spinner-border-sm d-none ms-2" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </form>

                <div id="sendResult" class="mt-4"></div>
            </div>
        </div>

        <!-- Section Premium -->
        <div class="card premium-section" id="premiumCard" style="display: none;">
            <div class="card-header premium-header">
                <h5 class="card-title mb-0 fw-bold">PASSER A LA VERSION PREMIUM</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <h4 class="text-warning fw-bold">Essai gratuit epuise !</h4>
                    <p class="lead">Vous avez utilise vos 2 emails gratuits.</p>
                    <p>Choisissez votre formule pour continuer a utiliser notre service.</p>
                </div>

                <div class="row g-4">
                    <!-- Formule Starter -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card plan-card">
                            <div class="card-body text-center d-flex flex-column">
                                <h5 class="card-title fw-bold">Starter</h5>
                                <h3 class="text-primary my-3">5€</h3>
                                <p class="text-muted">Par mois</p>
                                <ul class="list-unstyled mb-4 flex-grow-1">
                                    <li class="mb-2">50 emails/mois</li>
                                    <li class="mb-2">Support email</li>
                                    <li class="mb-2">Templates basiques</li>
                                    <li class="mb-2">1 compte utilisateur</li>
                                </ul>
                                <button class="btn btn-outline-primary w-100 mt-auto" onclick="selectPlan('starter')">
                                    Choisir ce plan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Formule Pro (Recommandee) -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card plan-card recommended">
                            <div class="recommended-badge">POPULAIRE</div>
                            <div class="card-body text-center d-flex flex-column">
                                <h5 class="card-title fw-bold">Pro</h5>
                                <h3 class="text-primary my-3">15€</h3>
                                <p class="text-muted">Par mois</p>
                                <ul class="list-unstyled mb-4 flex-grow-1">
                                    <li class="mb-2">200 emails/mois</li>
                                    <li class="mb-2">Support prioritaire</li>
                                    <li class="mb-2">Templates avances</li>
                                    <li class="mb-2">Analytics detaillees</li>
                                    <li class="mb-2">3 comptes utilisateurs</li>
                                </ul>
                                <button class="btn btn-warning w-100 mt-auto" onclick="selectPlan('pro')">
                                    Choisir ce plan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Formule Enterprise -->
                    <div class="col-lg-4 col-md-12">
                        <div class="card plan-card">
                            <div class="card-body text-center d-flex flex-column">
                                <h5 class="card-title fw-bold">Enterprise</h5>
                                <h3 class="text-primary my-3">50€</h3>
                                <p class="text-muted">Par mois</p>
                                <ul class="list-unstyled mb-4 flex-grow-1">
                                    <li class="mb-2">Emails illimites</li>
                                    <li class="mb-2">Support 24/7</li>
                                    <li class="mb-2">API complete</li>
                                    <li class="mb-2">Personnalisation</li>
                                    <li class="mb-2">Comptes illimites</li>
                                </ul>
                                <button class="btn btn-outline-primary w-100 mt-auto" onclick="selectPlan('enterprise')">
                                    Choisir ce plan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formulaire de paiement -->
                <div class="payment-form mt-4" id="paymentForm" style="display: none;">
                    <h5 class="text-center mb-4 fw-bold">Paiement securise</h5>
                    
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-semibold">Email de facturation</label>
                            <input type="email" class="form-control" id="billingEmail" placeholder="votre.email@example.com" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-semibold">Numero de carte</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Date d'expiration</label>
                            <input type="text" class="form-control" id="expiryDate" placeholder="MM/AA" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">CVV</label>
                            <input type="text" class="form-control" id="cvv" placeholder="123" required>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                <label class="form-check-label" for="termsCheck">
                                    J'accepte les <a href="#" class="text-decoration-none">conditions generales</a>
                                </label>
                            </div>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-success w-100 py-3 fw-semibold" onclick="processPayment()">
                                Payer maintenant - <span id="planPrice">15€</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <p class="text-muted">
                        Questions ? <a href="mailto:support@emailsender.com" class="text-decoration-none fw-semibold">support@emailsender.com</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://projetdesemail.vercel.app';
        let emailCount = 0;
        const MAX_FREE_EMAILS = 2;
        let selectedPlan = '';

        // Mettre a jour le compteur d'utilisation
        function updateUsageCounter() {
            document.getElementById('usageCount').textContent = `${emailCount}/${MAX_FREE_EMAILS}`;
            
            if (emailCount >= MAX_FREE_EMAILS) {
                document.getElementById('sendButton').classList.add('disabled-btn');
                document.getElementById('sendButton').disabled = true;
                document.getElementById('sendButton').innerHTML = 'Essai gratuit epuise';
                document.getElementById('premiumCard').style.display = 'block';
            }
        }

        // Gerer l'envoi du formulaire
        document.getElementById('emailForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await sendEmails();
        });

        async function sendEmails() {
            if (emailCount >= MAX_FREE_EMAILS) {
                alert('Vous avez utilise vos 2 emails gratuits. Passez a la version premium pour continuer.');
                document.getElementById('premiumCard').scrollIntoView({behavior: 'smooth'});
                return;
            }

            const sendButton = document.getElementById('sendButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultDiv = document.getElementById('sendResult');

            // Desactiver le bouton
            sendButton.disabled = true;
            buttonText.textContent = 'Envoi en cours...';
            loadingSpinner.classList.remove('d-none');
            resultDiv.innerHTML = '<div class="alert alert-info">Envoi des emails en cours...</div>';

            try {
                const formData = {
                    sender_email: document.getElementById('senderEmail').value,
                    sender_password: document.getElementById('senderPassword').value,
                    subject: document.getElementById('emailSubject').value,
                    message: document.getElementById('emailMessage').value,
                    recipients: document.getElementById('emailRecipients').value
                };

                // Verifier le nombre de destinataires
                const recipientCount = formData.recipients.split('\n').filter(email => email.trim()).length;
                if (recipientCount > 2) {
                    throw new Error('Limite d\'essai : maximum 2 destinataires autorises');
                }

                const response = await fetch(`${API_BASE_URL}/send_emails`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                // Incrementer le compteur
                emailCount++;
                updateUsageCounter();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6 class="fw-bold">Envoi reussi !</h6>
                            <p><strong>${data.message}</strong></p>
                            <p>Utilisation : ${emailCount}/${MAX_FREE_EMAILS} emails</p>
                            <div class="mt-3">
                                <strong>Resultats :</strong>
                                <div class="mt-2">
                                    ${data.results ? data.results.map(result => `
                                        <div class="${result.includes('✅') ? 'text-success' : 'text-danger'} small">
                                            ${result}
                                        </div>
                                    `).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <h6 class="fw-bold">Erreur</h6>
                            <p>${data.error}</p>
                        </div>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6 class="fw-bold">Erreur</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                if (emailCount < MAX_FREE_EMAILS) {
                    sendButton.disabled = false;
                    buttonText.textContent = 'Envoyer les emails';
                    loadingSpinner.classList.add('d-none');
                }
            }
        }

        // Selectionner un plan
        function selectPlan(plan) {
            selectedPlan = plan;
            const prices = {
                'starter': '5€',
                'pro': '15€',
                'enterprise': '50€'
            };
            
            document.getElementById('planPrice').textContent = prices[plan];
            document.getElementById('paymentForm').style.display = 'block';
            document.getElementById('paymentForm').scrollIntoView({behavior: 'smooth'});
        }

        // Traitement du paiement
        function processPayment() {
            const termsChecked = document.getElementById('termsCheck').checked;
            
            if (!termsChecked) {
                alert('Veuillez accepter les conditions generales');
                return;
            }

            // Simulation de paiement
            alert(`Paiement reussi ! Votre abonnement ${selectedPlan} est maintenant active.`);
            
            // Reactiver l'envoi d'emails
            emailCount = 0;
            updateUsageCounter();
            document.getElementById('premiumCard').style.display = 'none';
            document.getElementById('paymentForm').style.display = 'none';
            
            // Afficher message de succes
            document.getElementById('sendResult').innerHTML = `
                <div class="alert alert-success">
                    <h6 class="fw-bold">Felicitations !</h6>
                    <p>Votre abonnement premium est active. Vous pouvez maintenant envoyer des emails sans limite.</p>
                </div>
            `;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateUsageCounter();
        });
    </script>
</body>
</html>